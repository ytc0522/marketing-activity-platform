## 计划

1.11：
- 完成XXL-JOB的引入，以及对消息发送失败的补偿处理。

1.12-1.20：
- 编写分库分表组件，对活动订单进行分库分表测试

1.21-1.26：
- 分库分表后的问题，比如分布式事务解决、如何聚合查询、分页查询等测试。
  因为抽奖系统的库存放在redis中的，没有放在数据库中，这里很难处理分布式事务一致性问题。或者说，可能不用太在意分布式事务问题。

1.27-2.07：
- 使用DDD架构设计 完成秒杀系统的设计和开发。

2.08：
- 研究其他活动，比如拼团、助力、砍价活动等。
- 研究其他常见面试考点。

TODO LIST

- 参加活动的记录的代码实现，用户参与活动限制 已完成一半。
- 动态概率抽奖玩法的代码实现                    OK
- RabbitMQ 环境搭建，消息的可靠性保证！幂等性如何保证。
  - 发送端：发送失败的消息，定时任务补偿发送
  - 消费端：手动ACK，如果手动ACK之前，服务挂了，怎么办呢？ 消息不会移除也不会重试，当消费者断开连接，消息重新回到队列。
- 活动订单表：
- 规则树实现，应用于风控（发送奖励时）
- 分库分表路由组件的编码实现
- 活动订单的分库分表实现
- 分库分表后，活动订单的统计查询。
- 分库分表后，分布式事务问题解决。
- 秒杀系统的实现。
- 活动奖品如何发放？ 
- 风控措施，黑名单和IP如何设计，如何判断机器流量？
- 好友助力系统的实现
- 分布式网关 Gateway 这个可以写在marketing-platform 中
- 活动假如要出问题了，需要有降级功能。

用到的技术组件：
RabbitMQ、XXL-JOB、

## 发现的系统问题：

- lottery_detail 表是否可以变为 活动奖励表？
- 抽奖时，Redis库存扣减时，不应该同时进行 数据库库库存扣减吧？不然会出现一致性问题、性能问题
- 分布式事务问题：库存扣减这个动作和下单这个动作不在一个事务中，如何处理数据一致性问题。